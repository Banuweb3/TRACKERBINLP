<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Connectivity Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div class="p-8 max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üîç Network Connectivity Test</h1>
        
        <div class="space-y-4">
            <button id="testBasic" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium w-full">
                üåê Test 1: Basic ngrok Connection
            </button>
            
            <button id="testCORS" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium w-full">
                üîí Test 2: CORS Headers Test
            </button>
            
            <button id="testProxy" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium w-full">
                üîÑ Test 3: Alternative Method (JSONP)
            </button>
            
            <div id="results" class="mt-6 space-y-4"></div>
        </div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function addResult(title, content, type = 'info') {
            const colors = {
                success: 'bg-green-50 border-green-200 text-green-800',
                error: 'bg-red-50 border-red-200 text-red-800',
                info: 'bg-blue-50 border-blue-200 text-blue-800',
                warning: 'bg-yellow-50 border-yellow-200 text-yellow-800'
            };
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `border rounded-lg p-4 ${colors[type]}`;
            resultDiv.innerHTML = `
                <h3 class="font-bold mb-2">${title}</h3>
                <div class="text-sm">${content}</div>
            `;
            resultsDiv.appendChild(resultDiv);
        }

        // Test 1: Basic Connection
        document.getElementById('testBasic').addEventListener('click', async () => {
            addResult('üåê Test 1: Basic Connection', 'Testing basic connectivity...', 'info');
            
            try {
                const response = await fetch('https://commodiously-appositional-yung.ngrok-free.dev/api.php/', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('‚úÖ Basic Connection Success', 
                        `Status: ${response.status}<br>Data received: ${Array.isArray(data) ? data.length + ' records' : 'Invalid format'}`, 
                        'success');
                } else {
                    addResult('‚ùå Basic Connection Failed', 
                        `HTTP ${response.status}: ${response.statusText}`, 
                        'error');
                }
            } catch (error) {
                addResult('‚ùå Basic Connection Error', 
                    `Error: ${error.message}<br>This suggests network or CORS issues`, 
                    'error');
            }
        });

        // Test 2: CORS Headers
        document.getElementById('testCORS').addEventListener('click', async () => {
            addResult('üîí Test 2: CORS Headers', 'Testing with ngrok-specific headers...', 'info');
            
            try {
                const response = await fetch('https://commodiously-appositional-yung.ngrok-free.dev/api.php/', {
                    method: 'GET',
                    headers: {
                        'ngrok-skip-browser-warning': 'true',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('‚úÖ CORS Headers Success', 
                        `Status: ${response.status}<br>Headers worked! Data: ${Array.isArray(data) ? data.length + ' records' : 'Invalid format'}`, 
                        'success');
                } else {
                    addResult('‚ùå CORS Headers Failed', 
                        `HTTP ${response.status}: ${response.statusText}`, 
                        'error');
                }
            } catch (error) {
                addResult('‚ùå CORS Headers Error', 
                    `Error: ${error.message}<br>CORS headers didn't help`, 
                    'error');
            }
        });

        // Test 3: Alternative Method
        document.getElementById('testProxy').addEventListener('click', () => {
            addResult('üîÑ Test 3: Alternative Method', 'Trying alternative approach...', 'info');
            
            // Try using a different approach - create a script tag (JSONP-like)
            const script = document.createElement('script');
            const timeout = setTimeout(() => {
                addResult('‚è∞ Alternative Method Timeout', 
                    'Alternative method timed out. The API might not support JSONP.', 
                    'warning');
                document.head.removeChild(script);
            }, 10000);
            
            // Try a simple image request to test basic connectivity
            const img = new Image();
            img.onload = () => {
                clearTimeout(timeout);
                addResult('‚úÖ Basic Network OK', 
                    'Network connectivity is working. The issue is likely CORS-specific.', 
                    'success');
            };
            img.onerror = () => {
                clearTimeout(timeout);
                addResult('‚ùå Network Issue', 
                    'Basic network connectivity failed. Check your internet connection.', 
                    'error');
            };
            
            // Test with a simple request to a known working endpoint
            img.src = 'https://httpbin.org/status/200?' + Date.now();
        });

        // Auto-run basic test on load
        setTimeout(() => {
            document.getElementById('testBasic').click();
        }, 1000);
    </script>
</body>
</html>
